<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="moves_report_pdf" model="ir.actions.report">
        <field name="name">Reporte de Historial de Movimiento</field>
        <field name="model">report.movement.history</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">report_movement_history.report_moves_history</field>
    </record>

    <template id="report_moves_history">
        <t t-set="company" t-value="env.company"/>
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page">

                    <div class="row">
                        <div class="col-4">
                            <strong>Localizaci√≥n: </strong>
                            <span t-esc="env['stock.location'].browse(form['location']).complete_name"/>
                            
                        </div>
                        <div class="col-4">
                            <strong>Fecha Inicio: </strong>
                            <span t-esc="form['start_date']"/>
                        </div>
                        <div class="col-4">
                            <strong>Fecha Fin:</strong>
                            <span t-esc="form['end_date']"/>
                        </div>
                    </div>

                    <br/>

                    <t t-foreach="form['data']" t-as="product">
                        <div class="product-section">
                        
                            <div class="row">
                                <div class="col-12">
                                    <strong>Producto:</strong>
                                    <t t-if="product['product_data']">
                                        <t t-set="val_product" t-value="env['product.product'].browse(product['product_data'])"/>
                                        <t t-if="val_product.default_code">
                                            [<span t-esc="val_product.default_code"/>]
                                        </t>
                                        <span t-esc="val_product.name"/>
                                    </t>
                                </div>
                            </div>

                            <div class="row mb-2">
                                <div class="col-3">
                                    <strong>Saldo Inicial:</strong>
                                    <span t-esc="product['opening_balance']"/>
                                </div>
                                <div class="col-3">
                                    <strong>Total Entradas:</strong>
                                    <span t-esc="product['total_in']"/>
                                </div>
                                <div class="col-3">
                                    <strong>Total Salidas:</strong>
                                    <span t-esc="product['total_out']"/>
                                </div>
                                <div class="col-3">
                                    <strong>Saldo Final:</strong>
                                    <span t-esc="product['balance']"/>
                                </div>
                            </div>

                            <table class="table table-bordered">
                                <thead>
                                    <tr style="color: black !important;">
                                        <th>Fecha</th>
                                        <th>Tipo de Movimiento</th>
                                        <th>Entrada</th>
                                        <th>Salida</th>
                                        <th>Saldo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="product['lst']" t-as="move">
                                        <tr>
                                            <td t-esc="move['date']"/>
                                            <td>
                                                <t t-if="move['picking_type'] == 'Outgoing'">Saliente</t>
                                                <t t-elif="move['picking_type'] == 'Incoming'">Entrante</t>
                                                <t t-else="" t-esc="move['picking_type']"/>
                                            </td>
                                            <td t-esc="move['in']"/>
                                            <td t-esc="move['out']"/>
                                            <td t-esc="move['balance']"/>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                            
                        </div>
                        <hr/>
                    </t>
                    
                </div>
            </t>
        </t>    
    </template>
</odoo>